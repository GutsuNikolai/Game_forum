<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameForum - Игровое сообщество</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Хедер -->
    <div id="header"></div>

    <!-- Основной контент -->
    <main class="main-content">
        <div class="container">
            <!-- Герой-секция -->
            <section class="hero-section glass-panel">
                <div class="hero-content">
                    <h1 class="hero-title">
                        <span class="gradient-text">Крупнейшее игровое</span>
                        <span class="gradient-text">сообщество</span>
                    </h1>
                    <p class="hero-subtitle">
                        Присоединяйтесь к миллионам геймеров. Обсуждайте игры, 
                        находите единомышленников, создавайте группы и делитесь 
                        своими достижениями.
                    </p>
                    <div class="hero-buttons">
                        <button class="btn-primary glass-btn" id="joinBtn">
                            <i class="fas fa-gamepad"></i>
                            Присоединиться
                        </button>
                        <a href="/catalog.html" class="btn-secondary glass-btn">
                            <i class="fas fa-list"></i>
                            Каталог игр
                        </a>
                    </div>
                </div>
                <div class="hero-image">
                    <div class="game-card hero-showcase">
                        <img src="/img/covers/home_page.png"
                            alt="Игровая тематика" class="game-image hero-game-image">
                    </div>
                    <div class="hero-stats">
                        <div class="stat-item glass-card">
                            <i class="fas fa-users"></i>
                            <div>
                                <span class="stat-number">1,2M+</span>
                                <span class="stat-label">Участников</span>
                            </div>
                        </div>
                        <div class="stat-item glass-card">
                            <i class="fas fa-comments"></i>
                            <div>
                                <span class="stat-number">580K+</span>
                                <span class="stat-label">Обсуждений</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Популярные игры -->
            <section class="games-section">
                <div class="section-header">
                    <h2><i class="fas fa-fire"></i> Популярные игры</h2>
                    <a href="/catalog.html" class="view-all">
                        Все игры <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                                <div class="games-grid">
                    <div class="game-item glass-card">
                        <div class="game-rank">#1</div>
                        <div class="game-cover">
                            <img src="/img/covers/cs2.jpg" alt="Counter-Strike 2">
                        </div>
                        <div class="game-details">
                            <h3>Counter-Strike 2</h3>
                            <div class="game-meta">
                                <span class="game-category">Шутер</span>
                                <span class="game-rating">
                                    <i class="fas fa-star"></i> 9.0
                                </span>
                            </div>
                            <p class="game-description">
                                Соревновательный тактический шутер 5v5 с обновленным движком и картами.
                            </p>
                            <div class="game-stats">
                                <span><i class="fas fa-comments"></i> 0</span>
                            </div>
                        </div>
                        <button class="game-join glass-btn">
                            <i class="fas fa-comments"></i>
                            Обсудить
                        </button>
                    </div>

                    <div class="game-item glass-card">
                        <div class="game-rank">#2</div>
                        <div class="game-cover">
                            <img src="/img/covers/dota2.jpg" alt="Dota 2">
                        </div>
                        <div class="game-details">
                            <h3>Dota 2</h3>
                            <div class="game-meta">
                                <span class="game-category">MOBA</span>
                                <span class="game-rating">
                                    <i class="fas fa-star"></i> 0.0
                                </span>
                            </div>
                            <p class="game-description">
                                MOBA 5v5 с героями, линиями и командной стратегией.
                            </p>
                            <div class="game-stats">
                                <span><i class="fas fa-comments"></i> 0</span>
                            </div>
                        </div>
                        <button class="game-join glass-btn">
                            <i class="fas fa-comments"></i>
                            Обсудить
                        </button>
                    </div>
                </div>
            </section>

            <!-- Последние обсуждения -->
            <section class="discussions-section">
                <div class="section-header">
                    <h2><i class="fas fa-comments"></i> Последние обсуждения</h2>
                    <a href="#" class="view-all">
                        Все обсуждения <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <div class="discussions-list">
                    <!-- Обсуждение 1 -->
                    <div class="discussion-item glass-card">
                        <div class="discussion-header">
                            <div class="discussion-author">
                                <div class="author-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="author-info">
                                    <span class="author-name">Alex_Gamer</span>
                                    <span class="discussion-time">2 часа назад</span>
                                </div>
                            </div>
                            <div class="discussion-game">
                                <i class="fas fa-gamepad"></i>
                                <span>Cyberpunk 2077</span>
                            </div>
                        </div>
                        
                        <h3 class="discussion-title">
                            Как пройти сложного босса в акте 3?
                        </h3>
                        
                        <p class="discussion-preview">
                            Застрял на боссе в миссии "Враг моего врага". Пробовал разные тактики, 
                            но ничего не помогает. Есть советы?
                        </p>
                        
                        <div class="discussion-footer">
                            <div class="discussion-stats">
                                <span><i class="fas fa-comment"></i> 24</span>
                                <span><i class="fas fa-eye"></i> 156</span>
                                <span><i class="fas fa-heart"></i> 42</span>
                            </div>
                            <button class="discussion-join glass-btn">
                                <i class="fas fa-reply"></i>
                                Ответить
                            </button>
                        </div>
                    </div>

                    <!-- Обсуждение 2 -->
                    <div class="discussion-item glass-card">
                        <div class="discussion-header">
                            <div class="discussion-author">
                                <div class="author-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="author-info">
                                    <span class="author-name">ProGamerGirl</span>
                                    <span class="discussion-time">5 часов назад</span>
                                </div>
                            </div>
                            <div class="discussion-game">
                                <i class="fas fa-gamepad"></i>
                                <span>Valorant</span>
                            </div>
                        </div>
                        
                        <h3 class="discussion-title">
                            Ищем команду для участия в турнире
                        </h3>
                        
                        <p class="discussion-preview">
                            Формируем команду для участия в локальном турнире по Valorant. 
                            Нужны игроки ранга Diamond и выше. Пишите в ЛС!
                        </p>
                        
                        <div class="discussion-footer">
                            <div class="discussion-stats">
                                <span><i class="fas fa-comment"></i> 47</span>
                                <span><i class="fas fa-eye"></i> 289</span>
                                <span><i class="fas fa-heart"></i> 68</span>
                            </div>
                            <button class="discussion-join glass-btn">
                                <i class="fas fa-reply"></i>
                                Ответить
                            </button>
                        </div>
                    </div>

                    <!-- Обсуждение 3 -->
                    <div class="discussion-item glass-card">
                        <div class="discussion-header">
                            <div class="discussion-author">
                                <div class="author-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="author-info">
                                    <span class="author-name">BuilderMike</span>
                                    <span class="discussion-time">1 день назад</span>
                                </div>
                            </div>
                            <div class="discussion-game">
                                <i class="fas fa-gamepad"></i>
                                <span>Minecraft</span>
                            </div>
                        </div>
                        
                        <h3 class="discussion-title">
                            Показываю свою постройку - средневековый замок
                        </h3>
                        
                        <p class="discussion-preview">
                            Потратил 2 месяца на строительство замка в средневековом стиле. 
                            Внутри есть тайные комнаты и ловушки. Скриншоты внутри.
                        </p>
                        
                        <div class="discussion-footer">
                            <div class="discussion-stats">
                                <span><i class="fas fa-comment"></i> 89</span>
                                <span><i class="fas fa-eye"></i> 542</span>
                                <span><i class="fas fa-heart"></i> 124</span>
                            </div>
                            <button class="discussion-join glass-btn">
                                <i class="fas fa-reply"></i>
                                Ответить
                            </button>
                        </div>
                    </div>

                    <!-- Обсуждение 4 -->
                    <div class="discussion-item glass-card">
                        <div class="discussion-header">
                            <div class="discussion-author">
                                <div class="author-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="author-info">
                                    <span class="author-name">SoulsMaster</span>
                                    <span class="discussion-time">2 дня назад</span>
                                </div>
                            </div>
                            <div class="discussion-game">
                                <i class="fas fa-gamepad"></i>
                                <span>Elden Ring</span>
                            </div>
                        </div>
                        
                        <h3 class="discussion-title">
                            Гайд по сборке мага для новичков
                        </h3>
                        
                        <p class="discussion-preview">
                            Подробный гайд по созданию эффективной магической сборки с нуля. 
                            Статы, заклинания, снаряжение и тактика против боссов.
                        </p>
                        
                        <div class="discussion-footer">
                            <div class="discussion-stats">
                                <span><i class="fas fa-comment"></i> 156</span>
                                <span><i class="fas fa-eye"></i> 845</span>
                                <span><i class="fas fa-heart"></i> 267</span>
                            </div>
                            <button class="discussion-join glass-btn">
                                <i class="fas fa-reply"></i>
                                Ответить
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Преимущества -->
            <section class="features-section">
                <h2 class="section-title">Почему GameForum?</h2>
                
                <div class="features-grid">
                    <div class="feature-item glass-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Активное сообщество</h3>
                        <p>Более 1.2 миллиона активных участников ежедневно обсуждают игры</p>
                    </div>
                    
                    <div class="feature-item glass-card">
                        <div class="feature-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <h3>5000+ игр</h3>
                        <p>Обширный каталог игр от AAA-хитов до инди-проектов</p>
                    </div>
                    
                    <div class="feature-item glass-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Безопасность</h3>
                        <p>Модерация 24/7 и продвинутая система защиты от спама</p>
                    </div>
                    
                    <div class="feature-item glass-card">
                        <div class="feature-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3>Мобильный доступ</h3>
                        <p>Удобное приложение для iOS и Android для общения на ходу</p>
                    </div>
                    
                    <div class="feature-item glass-card">
                        <div class="feature-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h3>Турниры и события</h3>
                        <p>Регулярные турниры, ивенты и розыгрыши призов</p>
                    </div>
                    
                    <div class="feature-item glass-card">
                        <div class="feature-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <h3>Поддержка 24/7</h3>
                        <p>Круглосуточная техническая поддержка и помощь</p>
                    </div>
                </div>
            </section>

            <!-- CTA секция -->
            <section class="cta-section glass-panel">
                <div class="cta-content">
                    <h2>Присоединяйся к крупнейшему игровому сообществу!</h2>
                    <p>Создай аккаунт и начни общаться с геймерами со всего мира</p>
                    <div class="cta-buttons">
                        <button class="cta-btn-primary glass-btn" id="ctaRegisterBtn">
                            <i class="fas fa-user-plus"></i>
                            Создать аккаунт
                        </button>
                        <button class="cta-btn-secondary glass-btn">
                            <i class="fas fa-play-circle"></i>
                            Смотреть турниры
                        </button>
                    </div>
                </div>
                <div class="cta-image">
                    <div class="cta-stats">
                        <div class="cta-stat">
                            <span class="cta-stat-number">1,247</span>
                            <span class="cta-stat-label">Игроков онлайн</span>
                        </div>
                        <div class="cta-stat">
                            <span class="cta-stat-number">89</span>
                            <span class="cta-stat-label">Новых тем за час</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Футер -->
    <div id="footer"></div>

    <script src="/static/js/script.js"></script>
    <script>
        // Загрузка хедера и футера
    document.addEventListener('DOMContentLoaded', function() {
        // Загружаем хедер
        fetch('/fragments/header.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Не удалось загрузить хедер');
                }
                return response.text();
            })
            .then(data => {
                document.getElementById('header').innerHTML = data;
                console.log('Хедер загружен');
                // Инициализируем скрипты после загрузки хедера
                if (typeof initializeHeader === 'function') {
                    initializeHeader();
                }
            })
            .catch(error => {
                console.error('Ошибка загрузки хедера:', error);
                document.getElementById('header').innerHTML = '<div style="color: white; padding: 20px; text-align: center;">Ошибка загрузки хедера</div>';
            });

        // Загружаем футер
        fetch('/fragments/footer.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Не удалось загрузить футер');
                }
                return response.text();
            })
            .then(data => {
                document.getElementById('footer').innerHTML = data;
                console.log('Футер загружен');
            })
            .catch(error => {
                console.error('Ошибка загрузки футера:', error);
                document.getElementById('footer').innerHTML = '<div style="color: white; padding: 20px; text-align: center;">Ошибка загрузки футера</div>';
            });

        // Инициализация основных скриптов
        initializeMainScripts();
    });
        function escapeHtml(value) {
            return String(value)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function openTopicDiscussion(topicId, topicTitle, gameId) {
            sessionStorage.setItem('currentTopicId', String(topicId));
            sessionStorage.setItem('currentTopicTitle', topicTitle);
            sessionStorage.setItem('currentGameId', String(gameId));
            window.location.href = `/topic-discussion.html?topic=${topicId}`;
        }

        function bindLatestDiscussionButtons() {
            const buttons = document.querySelectorAll('.discussion-open');
            buttons.forEach(button => {
                if (button.dataset.bound === 'true') return;
                button.addEventListener('click', function() {
                    const topicId = Number(this.dataset.topicId || 0);
                    const gameId = Number(this.dataset.gameId || 1);
                    const topicTitle = this.dataset.topicTitle || 'Обсуждение';
                    if (topicId > 0) {
                        openTopicDiscussion(topicId, topicTitle, gameId);
                    }
                });
                button.dataset.bound = 'true';
            });
        }

        async function loadLatestDiscussionsSection() {
            const container = document.querySelector('.discussions-section .discussions-list');
            if (!container) return;

            try {
                const [topicsResp, gamesResp] = await Promise.all([
                    fetch('/api/forum/latest-topics?limit=5'),
                    fetch('/api/games?page=0&size=100')
                ]);
                if (!topicsResp.ok) return;

                const topics = await topicsResp.json();
                if (!Array.isArray(topics) || topics.length === 0) return;

                const gamesMap = new Map();
                if (gamesResp.ok) {
                    const gp = await gamesResp.json();
                    const items = Array.isArray(gp?.items) ? gp.items : [];
                    items.forEach(item => gamesMap.set(Number(item.id), item.title || `Игра #${item.id}`));
                }

                container.innerHTML = topics.map(topic => {
                    const topicId = Number(topic.id || 0);
                    const gameId = Number(topic.gameId || 1);
                    const title = escapeHtml(topic.title || 'Тема');
                    const description = escapeHtml(topic.description || 'Без описания');
                    const author = escapeHtml(topic.author || 'Участник');
                    const lastActivity = escapeHtml(topic.lastActivity || 'только что');
                    const replies = Number(topic.replies ?? 0);
                    const views = Number(topic.views ?? 0);
                    const gameTitle = escapeHtml(gamesMap.get(gameId) || `Игра #${gameId}`);

                    return `
                        <div class="discussion-item glass-card">
                            <div class="discussion-header">
                                <div class="discussion-author">
                                    <div class="author-avatar"><i class="fas fa-user"></i></div>
                                    <div class="author-info">
                                        <span class="author-name">${author}</span>
                                        <span class="discussion-time">${lastActivity}</span>
                                    </div>
                                </div>
                                <div class="discussion-game"><i class="fas fa-gamepad"></i><span>${gameTitle}</span></div>
                            </div>
                            <h3 class="discussion-title">${title}</h3>
                            <p class="discussion-preview">${description}</p>
                            <div class="discussion-footer">
                                <div class="discussion-stats">
                                    <span><i class="fas fa-comment"></i> ${replies}</span>
                                    <span><i class="fas fa-eye"></i> ${views}</span>
                                </div>
                                <button class="discussion-open glass-btn" data-topic-id="${topicId}" data-game-id="${gameId}" data-topic-title="${title}">
                                    <i class="fas fa-arrow-right"></i> Открыть
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Ошибка загрузки последних обсуждений:', error);
            }
        }

        function initializeMainScripts() {
            // Кнопка "Присоединиться" в герое
            const joinBtn = document.getElementById('joinBtn');
            if (joinBtn) {
                joinBtn.addEventListener('click', function() {
                    const registerModal = document.getElementById('registerModal');
                    if (typeof openModal === 'function' && registerModal) {
                        openModal(registerModal);
                        return;
                    }

                    window.location.href = '/auth/register.html';
                });
            }

            // Кнопки "Присоединиться" в карточках игр
            const gameJoinBtns = document.querySelectorAll('.game-join');
            gameJoinBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const gameTitle = this.closest('.game-item').querySelector('h3').textContent;
                    showNotification(`Вы присоединились к сообществу "${gameTitle}"!`, 'success');
                });
            });

            // Кнопки "Ответить" в обсуждениях
            // Последние 5 обсуждений из БД
            loadLatestDiscussionsSection().finally(() => {
                bindLatestDiscussionButtons();
            });

            // CTA кнопка регистрации
            const ctaRegisterBtn = document.getElementById('ctaRegisterBtn');
            if (ctaRegisterBtn) {
                ctaRegisterBtn.addEventListener('click', function() {
                    const registerModal = document.getElementById('registerModal');
                    if (typeof openModal === 'function' && registerModal) {
                        openModal(registerModal);
                        return;
                    }

                    window.location.href = '/auth/register.html';
                });
            }

            // Функция для отображения уведомлений
            function showNotification(message, type = 'info') {
                // Используем функцию из script.js
                if (typeof window.showNotification === 'function') {
                    window.showNotification(message, type);
                } else {
                    // Запасной вариант
                    alert(message);
                }
            }
        }
    </script>
</body>
</html>




